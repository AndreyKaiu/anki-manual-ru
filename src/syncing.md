# Синхронизация с AnkiWeb

<!-- toc -->

AnkiWeb — это сервис, который позволяет сохранять вашу коллекцию синхронизированной на нескольких устройствах и изучать материалы онлайн. Пожалуйста, зарегистрируйте [бесплатную учётную запись](https://ankiweb.net/), прежде чем следовать шагам ниже.

## Вводные видео

Для быстрого ознакомления с синхронизацией ознакомьтесь с [вводными видео по синхронизации](https://www.youtube.com/watch?v=YkiM4DPzSVc&list=PLGgmaKOIHykFoomqkBJAyGiDQ2kyiuTao&yt:cc=on) или [такое видео на русском](https://www.youtube.com/watch?v=A5lWQ48TRGo&list=PLZfqPxaVkKoZgBcZoe4J02LIguRRbAGDs&index=26)

## Настройка

Чтобы начать синхронизацию вашей коллекции между устройствами, нажмите кнопку синхронизации (верхняя правая на [главном экране](studying.md#Колоды)) или нажмите <kbd>Y</kbd> на клавиатуре. Вам будет предложено ввести ваш идентификатор и пароль AnkiWeb, которые вы создали в процессе регистрации.

Когда вы синхронизируете свою коллекцию впервые, Anki спросит вас, хотите ли вы загрузить или скачать. Если у вас есть карточки на вашем компьютере, а ваша учётная запись AnkiWeb пуста, выберите **Загрузить**, чтобы отправить ваши данные на AnkiWeb. Если у вас есть карточки на AnkiWeb с другого устройства и нет карточек на вашем компьютере, выберите **Скачать**, чтобы заменить пустую локальную коллекцию карточками, которые находятся на AnkiWeb. Если у вас есть разные карточки на обоих устройствах, [требуется дополнительная работа](#Слияние-конфликтов), чтобы избежать потери данных.

После завершения первоначальной односторонней синхронизации Anki сможет объединять изменения из нескольких мест с некоторыми исключениями.

Если несколько человек используют Anki на одной машине и вы создали профиль для каждого пользователя, каждому пользователю потребуется создать свою собственную учётную запись AnkiWeb для синхронизации. Если вы попытаетесь синхронизировать несколько профилей с одной учётной записью AnkiWeb, вы потеряете данные.

## Автоматическая синхронизация

После включения синхронизации Anki будет автоматически синхронизироваться каждый раз при закрытии или открытии вашей коллекции. Если вы предпочитаете синхронизировать вручную, вы можете отключить автоматическую синхронизацию в [настройках](preferences.md#Синхронизация) Anki.

## Цвет кнопки

Кнопка синхронизации изменит цвет на синий, когда требуется обычная синхронизация, и на красный, когда требуется полная синхронизация.

## Медиафайлы

Вы можете посмотреть [соответствующее видео](https://www.youtube.com/watch?v=phP9GGG-PxY) по этой теме.

Anki будет синхронизировать любые звуки и изображения, используемые вашими записями. Он заметит, когда медиафайлы были добавлены, удалены или заменены в вашей [папке с медиафайлами](files.md#Пользовательские-данные), но не заметит, если вы отредактировали существующие файлы. Чтобы ваши правки синхронизировались, вам нужно также добавить, удалить или заменить файл.

Односторонние синхронизации (когда вам предлагается загрузить или скачать) не влияют на то, как синхронизируются медиафайлы — изменения медиафайлов всегда объединяются.

Чтобы предотвратить случайную потерю данных, удаления будут синхронизироваться с другими устройствами только в том случае, если они были сделаны после полной синхронизации медиафайлов. Если вы удалите файлы до того, как ваше устройство полностью синхронизируется, а удалённые файлы уже находятся на AnkiWeb, они будут загружены в следующий раз при синхронизации.

Если вы случайно удалили медиафайлы и хотите их восстановить, откройте настройки и выйдите из системы. При следующей синхронизации Anki восстановит любые удалённые файлы, если они всё ещё доступны на AnkiWeb.

Если вы запускаете Anki с [USB-флеш/накопителя](files.md#Запуск-с-флеш-накопителя), вам следует использовать файловую систему NTFS, так как Anki может не обнаруживать изменения медиафайлов в файловой системе FAT32.

## Конфликты

Вы можете посмотреть [соответствующее видео](https://www.youtube.com/watch?v=UEAcpfMQnjo) по этой теме.

В обычных условиях повторения и правки записей могут быть объединены, поэтому если вы повторяете или редактируете на двух разных устройствах перед синхронизацией, Anki сохранит ваши изменения из обоих мест. Если одна и та же карточка была повторена в двух разных местах, оба повторения будут отмечены в истории повторений, и карточка останется в том состоянии, в котором она была при последнем ответе.

Существуют определённые изменения, которые Anki не может объединить. Они в основном связаны с форматом записей: такие вещи, как добавление нового поля или удаление шаблона карточки. Когда вы выполняете операцию, которую нельзя объединить, Anki предупредит вас и даст возможность прервать операцию. Если вы решите продолжить, при следующей синхронизации вашей коллекции вам будет предложено выбрать, оставить ли локальную копию или копию на AnkiWeb.

Если при синхронизации обнаружены определённые проблемы, Anki принудительно выполняет одностороннюю синхронизацию. Если вы замечаете, что это происходит постоянно, пожалуйста, напишите на нашем [сайте поддержки](https://forums.ankiweb.net).

Когда требуется односторонняя синхронизация, вам нужно выбрать, хотите ли вы сохранить коллекцию на локальном устройстве или коллекцию на AnkiWeb. Если изменения были внесены на обоих концах, то можно будет сохранить изменения только с одного конца.

Если вы выберете **Загрузить**, содержимое с вашего локального устройства будет отправлено на AnkiWeb. Затем вам нужно синхронизировать другие устройства и выбрать **Скачать**, чтобы они получили копию этого содержимого.

Если вы выберете **Скачать**, это заменит любые локальные изменения, которые вы сделали, данными, находящимися на AnkiWeb.

После того как все устройства будут синхронизированы, будущие синхронизации вернутся к обычному поведению объединения изменений с обоих концов.

Если вы хотите принудительно выполнить полную загрузку или скачивание (например, потому что вы случайно удалили колоду на одной стороне и хотите восстановить колоду, а не синхронизировать её удаление), вы можете установить флажок «При следующей синхронизации перезаписать в одном направлении» в разделе «**Инструменты > Настройки > Сеть**», а затем синхронизироваться как обычно. (Вам будет предоставлена возможность выбрать, какую сторону вы хотите использовать.)

Принудительная односторонняя синхронизация влияет только на синхронизацию карточек — медиафайлы синхронизируются как обычно. Если у вас есть файлы, которые вы хотите удалить с AnkiWeb, пожалуйста, сначала убедитесь, что ваш клиент полностью синхронизирован. После того как синхронизация будет актуальна, любые файлы, которые вы удалите (например, с помощью функции «**Инструменты > Проверить медиафайлы**»), будут удалены с AnkiWeb при следующей синхронизации.

## Слияние конфликтов

Поскольку [первоначальная синхронизация](#Настройка) может синхронизировать изменения только в одном направлении, если вы добавили разный контент на разные устройства или профили перед настройкой синхронизации, контент на одном устройстве будет потерян, если вы перезапишете его контентом с другого устройства. При некоторой работе можно вручную объединить данные в единую коллекцию.

Начните с создания резервной копии на каждом устройстве/профиле на случай, если что-то пойдёт не так. В компьютерной версии вы можете использовать «**Файл > Экспортировать**», чтобы экспортировать «все колоды» с информацией о планировании и медиафайлами, и сохранить файл в безопасном месте. В AnkiMobile кнопка Добавить/Экспорт на экране списка колод позволит вам экспортировать все колоды с медиафайлами.

Далее, если одно из ваших устройств является мобильным устройством, синхронизируйте его первым. Если возникнет конфликт, выберите **Загрузить**, чтобы перезаписать любые существующие данные на AnkiWeb данными с вашего мобильного устройства. Если оба устройства/профиля находятся на вашем компьютере, синхронизируйте сначала устройство/профиль с наибольшим количеством колод.

Теперь вернитесь к другому устройству/профилю. Если автоматическая синхронизация включена, может появиться сообщение с вопросом, хотите ли вы загрузить или скачать. Нажмите кнопку отмены — мы пока не хотим синхронизироваться.

Когда вы увидите список колод, нажмите значок шестерёнки рядом с первой колодой и выберите **Экспорт**. Экспортируйте содержимое с информацией о планировании и медиафайлами и сохраните файл `.apkg` где-нибудь. Теперь вам нужно повторить это для каждой колоды верхнего уровня.

После того как все колоды верхнего уровня экспортированы, нажмите кнопку синхронизации в правом верхнем углу и выберите **Скачать**, что перезапишет локальное содержимое содержимым, которое вы синхронизировали с другого устройства.

Теперь вы можете использовать «**Файл > Импорт**», чтобы импортировать файлы `.apkg`, которые вы экспортировали ранее, что объединит экспортированное содержимое с существующим содержимым, так что всё будет в одном месте.

## Удаление данных AnkiWeb

Поскольку AnkiWeb — это бесплатный сервис, нам необходимо периодически удалять неиспользуемые данные учётных записей, чтобы снизить расходы. Если вы не заходили в свою учётную запись или не синхронизировались в течение последних 6 месяцев, данные в вашей учётной записи могут быть удалены.

### Что удаляется

Удаляются только ваши данные, хранящиеся на AnkiWeb. Сама ваша учётная запись останется и может быть использована снова.

Любые карточки, которые вы храните на своём компьютере, телефоне или планшете, останутся на этих устройствах. Элементы, опубликованные из вашей учётной записи, включая колоды и дополнения, также останутся на AnkiWeb.

### Возвращение в AnkiWeb

После того как данные ваших колод устарели, мы не можем восстановить ваши данные из AnkiWeb, но вы можете восстановить их, если у вас есть локальная копия или [резервная копия](./backups.md).

### Предотвращение удаления данных

Каждый раз, когда вы посещаете ankiweb.net или используете функцию синхронизации в Anki, AnkiMobile или AnkiDroid, ваша учётная запись автоматически будет помечена как активная.

Если ваша учётная запись была неактивна в течение 6 месяцев или более, и вы использовали сервис в течение недели или дольше, мы отправим вам электронное письмо с уведомлением о предстоящем удалении. Если вы хотите сохранить свою учётную запись активной, пожалуйста, войдите на ankiweb.net и изучите карточку или синхронизируйте одно из своих устройств в течение 30 дней.

## Фаерволы

Anki должен иметь возможность устанавливать исходящие HTTPS-соединения для синхронизации. Он должен иметь возможность подключиться к ankiweb.net, sync.ankiweb.net, sync2.ankiweb.net и так далее. Эти домены могут меняться со временем, и IP-адреса, на которые они указывают, также могут меняться, поэтому мы рекомендуем разрешить доступ по подстановочному знаку к `\*.ankiweb.net`, чтобы снизить вероятность необходимости обновления правил фаервола в будущем.

Если на вашем компьютере есть фаервол, вам следует добавить исключение для Anki. Если вы находитесь в рабочей или учебной сети, обратитесь за помощью к администратору сети — это не то, с чем мы можем вам помочь.

## Прокси

Если вам нужен прокси для доступа в интернет, Anki должен автоматически подхватить настройки системного прокси, если вы используете Windows или macOS, и будет учитывать переменную окружения HTTP_PROXY, если вы используете другую платформу.

Anki сможет подхватить ваши системные настройки, только если прокси настроен вручную и не требует пароля. Если ваша система использует автоматическую настройку прокси или использует прокси, который требует имя пользователя и пароль, вам нужно будет вручную указать Anki конфигурацию прокси.

Чтобы сообщить Anki ваши настройки прокси, определите переменную окружения HTTPS_PROXY, которая указывает на прокси-сервер. Она будет выглядеть так:

    http://user:pass@proxy.company.com:8080

Если ваше имя пользователя или пароль содержат символ @ (например, `user@workdomain.com`), вам нужно заменить его на %40, например:

    http://user%40workdomain.com:pass@proxy.company.com:8080

Anki 2.0 ожидает найти HTTP_PROXY вместо HTTPS_PROXY.

Чтобы установить переменные окружения в Windows, пожалуйста, посмотрите <https://www.google.com/search?q=windows+set+environmental+variable>.

Если вы используете Mac, пожалуйста, посмотрите <http://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x>.

Сильно ограниченные сети, которые перехватывают защищённые соединения и представляют свои собственные сертификаты, могут вызывать ошибки SSL в Anki. В таких средах вы можете обойти ошибки с помощью [этого дополнения](https://ankiweb.net/shared/info/1332261690).

Альтернативным решением является установка локального прокси-сервера и указание этого прокси-сервера на ваш обычный прокси-сервер. Затем вы можете указать Anki использовать локальный прокси, который будет перенаправлять запросы на прокси, который вы обычно используете.
